<!DOCTYPE html>
<html = style="height: 100%;">

<head>
	<title>Arathia World Map</title>
	<meta charset="UTF-8">
	<link rel="icon" href="icons/arathia.png">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="scripts/leaflet.css">
	<link rel="stylesheet" href="scripts/src/leaflet.groupedlayercontrol.css" />
	<link rel="stylesheet" href="scripts/leaflet-search/src/leaflet-search.css" />
	<link rel="stylesheet" href="style/style.css">
	<script src="scripts/leaflet.js"></script>
	<script src="scripts/src/leaflet.groupedlayercontrol.js"></script>
	<script src="scripts/leaflet-search/src/leaflet-search.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-editable/1.0.0/Leaflet.Editable.min.js"></script>
</head>

<body style="height: 100%;margin: 0;overflow-y: hidden;overflow-x: hidden;">
	<div id="map" style="width: 100%; height: 100%; background: #31565a;"></div>
	<a class="leaflet-control-zoom-out" href="index" title="Zoom out" role="button"
        aria-label="Zoom out" aria-disabled="false"><span aria-hidden="true">âˆ’</span></a>
	<script src="scripts/custom-scripts.js"></script>
	<script type="text/javascript">
		// MAPS
		var radioButtonsInfo = [
			{ label: "Default Icons", option: "option1", checkedIndex: 1, suffix: '' },
			{ label: "Old Icons", option: "option2", checkedIndex: 2, suffix: 'Old' },
			{ label: "Simple Icons", option: "option3", checkedIndex: 3, suffix: 'Simple' }
		];

		var neededMaps = [
			arathia,
			arathiaClean,
			morturia
		];

		const countryColors = {
			"Antaria": "#cc0000",
			"Primoria": "#674ea7",
			"Dryadalis": "#6aa84f",
			"Gigantoria": "#d5a6bd",
			"Trade Company": "#ffd966",
			"Odrheim": "#a64d79",
			"Tunglheimr": "#45818e",
			"Arcarum": "#8e7cc3",
			"Golden Order": "#f3cc52",
			"Free People of Antaria": "#a61c00",
			"Rheinland": "#666666",
			"Azurith": "#e69138",
			"Tsuki": "#3c78d8",
		};

		countryPolygons = {
			"Arathia": {
				"Antaria": turf.polygon([[
					[-11.324858, -53.056488],
					[-20.92278, -65.849245],
					[-29.801983, -69.785478],
					[-29.944201, -83.890313],
					[-22.501032, -88.45768],
					[-27.353804, -111.279933],
					[-17.165309, -124.981265],
					[-4.766854, -130.176739],
					[5.178482, -137.8125],
					[4.565474, -161.191406],
					[9.210917, -167.989128],
					[63.004195, -156.054583],
					[66.517935,-141.433598],
					[66.791909, -17.841797],
					[49.74405, -10.549323],
					[38.232526, 6.825983],
					[38.679755, 47.660703],
					[37.159287, 75.716726],
					[31.504309, 91.993503],
					[27.212716, 90.137379],
					[22.419721, 100.131891],
					[25.098281, 108.270279],
					[16.704856, 113.767261],
					[-0.115382, 119.050074],
					[-10.759978, 92.207671],
					[6.651616, 73.717824],
					[7.360175, 60.867737],
					[1.169545, 42.734837],
					[2.453884, 32.240599],
					[-4.465606, 21.246636],
					[-4.679092, 14.250478],
					[4.235506, 6.183479],
					[6.864296, -11.806642],
					[5.302624, -31.010383],
					[-0.615096, -44.288806],
					[-11.324858, -53.056488]
				]]),
				"Primoria": turf.polygon([[
					[-12.506265, -54.589186],
					[-17.107815, -61.297961],
					[-21.598419, -65.734409],
					[-29.497023, -68.43956],
					[-30.620835, -82.830965],
					[-23.298448, -88.45768],
					[-22.414977, -90.991202],
					[-28.550868, -114.751751],
					[-69.38392, -110.09889],
					[-69.459985, -27.429467],
					[-37.857291, -24.075079],
					[-26.4394, -47.988617],
					[-12.506265, -54.589186]
				]]),
				"Dryadalis": turf.polygon([[
					[-20.417763, -140.569393],
					[-27.305851, -164.575674],
					[-62.682708, -166.083315],
					[-61.321926, -115.287415],
					[-38.563192, -115.51936],
					[-20.634982, -129.783962],
					[-20.417763, -140.569393]
				]]),
				"Gigantoria": turf.polygon([[
					[1.704713, -35.829382],
					[-3.947162, -44.093199],
					[-16.693686, -48.529647],
					[-33.373368, -35.436715],
					[-15.966807, -29.918206],
					[2.325024, -31.541297],
					[1.704713, -35.829382]
				]]),
				"Trade Company": turf.polygon([[
					[5.239907, -31.433091],
					[-29.77917, -28.944351],
					[-21.497776, -14.769359],
					[-8.356947, -8.060583],
					[5.347651, -20.179661],
					[5.239907, -31.433091]
				]]),
				"Odrheim": turf.polygon([[
					[38.479395, 2.636719],
					[67.974634, 3.427734],
					[67.474922, 79.804688],
					[54.41893, 78.486328],
					[52.908902, 72.685547],
					[53.225768, 69.257813],
					[51.727028, 63.632813],
					[46.679594, 55.986328],
					[38.822591, 47.373047],
					[38.479395, 2.636719]
				]]),
				"Tunglheimr": turf.polygon([[
					[38.745724, 47.361506],
					[47.635784, 59.238281],
					[51.508742, 64.072266],
					[52.802761, 70.048828],
					[52.696361, 74.53125],
					[54.521081, 79.101563],
					[47.338823, 77.080078],
					[42.811522, 74.882813],
					[37.649034, 75.234375],
					[38.745724, 47.361506]
				]]),
				"Arcarum": turf.polygon([[
					[6.087936, -16.710896],
					[-4.276129, -11.666098],
					[-8.30985, -7.781023],
					[-4.854148, 6.251634],
					[3.430009, 8.513096],
					[3.603639, -0.822681],
					[5.914931, -8.59283],
					[6.087936, -16.710896]
				]]),
				"Golden Order": turf.polygon([[
					[31.382497, 91.993503],
					[29.78467, 99.13244],
					[25.485557, 107.913332],
					[22.749294, 100.417448],
					[27.339618, 90.280158],
					[31.382497, 91.993503]
				]]),
				"Free People of Antaria": turf.polygon([[
					[4.302591, -161.455078],
					[-16.972741, -153.28125],
					[-14.093957, -126.123047],
					[-5.090944, -130.341797],
					[2.899153, -135.263672],
					[4.65308, -139.21875],
					[4.302591, -161.455078]
				]]),
				"Rheinland": turf.polygon([[
					[66.407955, 80.771484],
					[59.085739, 141.943359],
					[-1.58183, 162.949219],
					[-2.108899, 151.171875],
					[-1.230374, 139.21875],
					[1.406109, 133.154297],
					[0, 127.617188],
					[0.878872, 123.222656],
					[0.263671, 119.707031],
					[12.554564, 114.785156],
					[25.244696, 108.808594],
					[31.503629, 93.164063],
					[37.439974, 76.728516],
					[43.580391, 75.849609],
					[51.234407, 78.222656],
					[66.407955, 80.771484]
				]]),
				"Azurith": turf.polygon([[
					[-14.244218, 87.852919],
					[-7.376635, 97.91882],
					[-2.185144, 112.410863],
					[-0.186772, 122.97649],
					[-0.972008, 128.259303],
					[0.455728, 132.471276],
					[-2.25648, 138.967709],
					[-3.183486, 161.312582],
					[-67.040988, 161.938609],
					[-67.521017, 82.389096],
					[-58.004872, 83.303947],
					[-25.47065, 87.633508],
					[-14.244218, 87.852919]
				]]),
				"Tsuki": turf.polygon([[
					[-9.227056, -8.281838],
					[-26.778009, -19.584528],
					[-47.283824, -18.204425],
					[-68.71374, 17.959715],
					[-68.891647, 78.151277],
					[-61.555619, 82.169514],
					[-26.549734, 87.089805],
					[-7.360757, 84.79367],
					[5.076992, 75.199102],
					[7.68466, 64.128447],
					[3.02475, 51.132943],
					[-0.082657, 43.217209],
					[1.803157, 32.474574],
					[-6.302278, 23.782059],
					[-4.996603, 9.349205],
					[-9.227056, -8.281838]
				]]),
			},
			"Morturia": {
				"Scientia": turf.polygon([[
					[45.291623, -5.485368],
					[65.082916, 30.568977],
					[64.715705, 128.820072],
					[20.992086, 139.099647],
					[-7.392287, 105.880389],
					[-9.746073, 58.16152],
					[30.619514, 18.99093],
					[39.711555, -0.918984],
					[45.291623, -5.485368]
				]]),
				"Ardeat": turf.polygon([[
					[66.034707, -131.453127],
					[55.119416, -20.418557],
					[-13.247799, -63.389099],
					[-21.8391, -165.239127],
					[21.380443, -165.731156],
					[66.034707, -131.453127]
				]]),
				"Gelida": turf.polygon([[
					[13.688048, -35.425543],
					[-13.407391, 9.59522],
					[-8.578925, 96.848383],
					[-54.743236, 88.811907],
					[-67.647149, 22.551986],
					[-54.458219, -107.179691],
					[-13.407391, -68.63741],
					[13.688048, -35.425543]
				]]),
			}
		}

		var oldSuffix = "";
		var currentSelectedMap = arathia;
		var selectedOptionId = 'arOption1';
		var iconChecked = 1;
		var currentMap = 'Arathia';

		// Define a map to convert between optionIds when switching map types
		var optionIdConversions = {
			'arOption2': 'arCleanOption2',
			'moOption2': 'moCleanOption2'
		};

		const regionMap = {
			"an": "ar",
			"od": "ar",
			"th": "ar",
			"rh": "ar",
			"az": "ar",
			"ts": "ar",
			"pr": "ar",
			"dr": "ar",
			"tc": "ar",
			"gi": "ar",
			"ac": "ar",
			"go": "ar",
			"fp": "ar",
		};

		var southWest = L.latLng(-70, -170),
			northEast = L.latLng(70, 170),
			bounds = L.latLngBounds(southWest, northEast);

		//Creating the Map
		var map = L.map('map', {
			maxBounds: bounds,
			zoomSnap: 0.1,
			zoomDelta: 0.5,
			wheelPxPerZoomLevel: 120,
		}).setView([0, 0], 0);

		map.createPane('addPane');
		map.createPane('basePane');
		map.createPane('backgroundPane');

		map.getPane('addPane').style.zIndex = 250;
		map.getPane('basePane').style.zIndex = 220;
		map.getPane('backgroundPane').style.zIndex = 150;

		// Maps createMap(title, noWrap, minZoom, maxZoom, pane, add)
		var arathia = createMap('Main', 'arathia', true, 2.75, 5.4, 'basePane', true);
		var arathiaClean = createMap('Main', 'arathiaClean', true, 2.75, 5.4, 'basePane', false);
		var Test = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var Test2 = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var Test3 = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var Test4 = createMap('Main', 'morturia', true, 2.75, 5.4, 'addPane', false);
		var morturia = createMap('Main', 'morturia', true, 2.75, 5.4, 'basePane', false);
		var arathiaBackground = createMap('Main', 'arathiaBackground', false, 2.75, 5.4, 'backgroundPane', true);
		var morturiaBackground = createMap('Main', 'morturiaBackground', false, 2.75, 5.4, 'backgroundPane', false);

		// Icons Settings: { size = image size, anchor = where on the image is on the coordinate, popupAnchor = where the popup will be anchored to the marker }
		var defaultIconSettings = { size: [31, 41], anchor: [15, 41], popupAnchor: [1, -44] };
		var oldIconSettings = { size: [31, 41], anchor: [15, 41], popupAnchor: [1, -44] };
		var simpleIconSettings = { size: [31, 41], anchor: [15, 25], popupAnchor: [1, -22] };

		// Icons
		var icons = {
			capital: createIcon('capital', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			cityBig: createIcon('cityBig', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			citySmall: createIcon('citySmall', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			town: createIcon('town', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			nature: createIcon('nature', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			important: createIcon('important', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
			character: createIcon('character', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor),
	
			capitalOld: createIcon('capitalOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			cityBigOld: createIcon('cityBigOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			citySmallOld: createIcon('citySmallOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			townOld: createIcon('townOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			natureOld: createIcon('natureOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			importantOld: createIcon('importantOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),
			characterOld: createIcon('characterOld', 'defaultShadow', oldIconSettings.size, oldIconSettings.anchor, oldIconSettings.popupAnchor),

			capitalSimple: createIcon('capitalSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0.5, 0] }).popupAnchor),
			cityBigSimple: createIcon('cityBigSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, simpleIconSettings.popupAnchor),
			citySmallSimple: createIcon('citySmallSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0, 4] }).popupAnchor),
			townSimple: createIcon('townSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0, 6] }).popupAnchor),
			natureSimple: createIcon('natureSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0, 8] }).popupAnchor),
			importantSimple: createIcon('importantSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, adjustSettings(simpleIconSettings, { popupAnchor: [0.5, 0] }).popupAnchor),
			characterSimple: createIcon('characterSimple', 'transparent', simpleIconSettings.size, simpleIconSettings.anchor, simpleIconSettings.popupAnchor),

			defaultIcon: createIcon('marker-icon', 'defaultShadow', defaultIconSettings.size, defaultIconSettings.anchor, defaultIconSettings.popupAnchor)
		}

		var fileInput = createFileInput();

		var formHTML = `
			<div class="custom-container">
				<span class="custom-title"><font size="+0.5">Marker Maker</font></span>
				<span class="custom-subtitle"><font size="-1">Coords</font></span>
				<input class="custom-input" type="text" id="Coords" placeholder="Coords"></input>
				<img style="height:3px;width: 100%; display: block; margin-left: auto; margin-right: auto; margin-bottom: 0px; margin-top: 0px;" src="icons/divider_small.png" alt="map popup divider">
				<span class="custom-subtitle"><font size="-1">Country</font></span>
				<select class="custom-select" name="Id" id="Id">
					<option value="ac">Arcarum</option>
					<option value="an">Antaria</option>
					<option value="az">Azurith</option>
					<option value="dr">Dryadalis</option>
					<option value="fp">Free People of Antaria</option>
					<option value="gi">Gigantoria</option>
					<option value="go">Golden Order</option>
					<option value="od">Odrheim</option>
					<option value="pr">Primoria</option>
					<option value="rh">Rheinland</option>
					<option value="tc">Trade Company</option>
					<option value="th">Tunglheimr</option>
					<option value="ts">Tsuki</option>
					<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
					<option value="ad">Ardeat</option>
					<option value="ge">Gelida</option>
					<option value="sc">Scientia</option>
				</select>
				<input class="custom-input" type="text" id="Title" placeholder="Title"></input>
				<span class="custom-subtitle"><font size="-1">Category</font></span>
				<select class="custom-select" name="Category" id="Category">
					<option value="capital" id="Capital">Capital</option>
					<option value="cityBig" id="Big City">Big City</option>
					<option value="citySmall" id="Small City">Small City</option>
					<option value="town"id="Town">Town</option>
					<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
					<option value="nature" id="Forest">Forest</option>
					<option value="nature" id="Mountain">Mountain</option>
					<option value="nature" id="Cave">Cave</option>
					<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
					<option value="important" id="Important Location">Important Location</option>
					<option value="important" id="Historical Location">Historical Location</option>
					<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
					<option value="character" id="Character">Character</option>
					</select>
				<input class="custom-input" type="text" id="Description" placeholder="Description"></input>
				<div class="custom-checkbox-container">
					<input class="custom-checkbox" type="checkbox" id="Link">
					<label for="Link">Link?</label>
				</div>
				<input class="custom-input" type="text" id="LinkText" placeholder="Custom link text (optional)"></input>
				<input class="custom-input" type="text" id="CustomId" placeholder="Custom id name (optional)"></input>
				<button class="custom-button" id="DevButton">Generate</button>
				<input class="custom-input" type="text" id="Output" placeholder="Output"></input>
			</div>
			`;

		//Marker Maker
		var marker = L.marker([0, 0], {
			draggable: true,
			id: "markerMaker"
		}).on('dragend', function() {
			marker.openPopup();
			markerMaker(true);
		});

		marker.bindPopup(formHTML).openPopup();
		marker.on('click', function(e) {
			markerMaker(true);
		});

		var regionLayerGroups = {
			'ar': {
				'capital': L.layerGroup().addTo(map),
				'cityBig': L.layerGroup().addTo(map),
				'citySmall': L.layerGroup().addTo(map),
				'town': L.layerGroup().addTo(map),
				'nature': L.layerGroup().addTo(map),
				'important': L.layerGroup().addTo(map),
				'character': L.layerGroup().addTo(map)
			},
			'mo': {
				'capital': L.layerGroup(),
				'cityBig': L.layerGroup(),
				'citySmall': L.layerGroup(),
				'town': L.layerGroup(),
				'nature': L.layerGroup(),
				'important': L.layerGroup(),
				'character': L.layerGroup()
			},
		};

		//Marker Groups
		var ar_all_layers = L.layerGroup([regionLayerGroups['ar']['capital'], regionLayerGroups['ar']['cityBig'], regionLayerGroups['ar']['citySmall'], regionLayerGroups['ar']['town'], regionLayerGroups['ar']['nature'], regionLayerGroups['ar']['important'], regionLayerGroups['ar']['character']]);

		var mo_all_layers = L.layerGroup([regionLayerGroups['mo']['capital'], regionLayerGroups['mo']['cityBig'], regionLayerGroups['mo']['citySmall'], regionLayerGroups['mo']['town'], regionLayerGroups['mo']['nature'], regionLayerGroups['mo']['important'], regionLayerGroups['mo']['character']]);
		
		var dv_coord = L.layerGroup([marker]);

		var groups = [ar_all_layers, mo_all_layers, dv_coord];
		const regionCodes = ['ar', 'mo'];
		const layerTypes = ['capital', 'cityBig', 'citySmall', 'town', 'nature', 'important', 'character'];

		const layerGroups = [];

		regionCodes.forEach(regionCode => {
			layerTypes.forEach(layerType => {
				const layerGroup = regionLayerGroups[regionCode][layerType];
				if (layerGroup) { // Check if the layerGroup exists before adding
					layerGroups.push(layerGroup);
				}
			});
		});
		
		//Marker Overlay
		var overlays = {
			"Arathia": {
				"Capitals": regionLayerGroups['ar']['capital'],
				"Large Cities": regionLayerGroups['ar']['cityBig'],
				"Small Cities": regionLayerGroups['ar']['citySmall'],
				"Towns": regionLayerGroups['ar']['town'],
				"Nature": regionLayerGroups['ar']['nature'],
				"Locations": regionLayerGroups['ar']['important'],
				"Characters": regionLayerGroups['ar']['character'],
			},
			"Morturia": {
				"Capitals": regionLayerGroups['mo']['capital'],
				"Large Cities": regionLayerGroups['mo']['cityBig'],
				"Small Cities": regionLayerGroups['mo']['citySmall'],
				"Towns": regionLayerGroups['mo']['town'],
				"Nature": regionLayerGroups['mo']['nature'],
				"Locations": regionLayerGroups['mo']['important'],
				"Characters": regionLayerGroups['mo']['character'],
			},
			"Developer": {
				"Marker Maker": dv_coord,
			}
		};
		var options = {
			groupCheckboxes: true
		};
		var mapLayers = {
			"Arathia": arathia,
			"Arathia Clean": arathiaClean,
			"Morturia": morturia,
		}

		//GROUP CONTROLS
		L.control.groupedLayers(mapLayers, overlays, options).addTo(map);

		var controlSearchAr = new L.Control.Search({
			position:'topleft',		
			layer: ar_all_layers, 
			zoom: 5,
			initial: false,
			marker: false
		}).on("search:locationfound", function (e) {
			if (e.layer._popup) e.layer.openPopup();
		});
		var controlSearchMo = new L.Control.Search({
			position:'topleft',		
			layer: mo_all_layers, 
			zoom: 5,
			initial: false,
			marker: false
		}).on("search:locationfound", function (e) {
			if (e.layer._popup) e.layer.openPopup();
		});

		var allSearch = [
			controlSearchAr, 
			controlSearchMo
		];

		map.addControl( controlSearchAr );

		// Background color and Search to use for map
		var mapConfigurations = {
			'Arathia': {
				color: '#31565a',
				options: {
					'arOption1': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: arathia,
						show: [ar_all_layers, arathiaBackground],
						hide: [mo_all_layers, morturiaBackground],
						checkboxIndex: 0,
						checkboxState: true,
						hideCheckboxCount: 2,
					},
					'arOption2': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: Test,
						show: [mo_all_layers, arathiaBackground],
						hide: [ar_all_layers, morturiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxCount: 1,
					},
				},
				show: [ar_all_layers, arathiaBackground],
				hide: [mo_all_layers, morturiaBackground],
				current: arathia,
				checkboxIndex: 0, 
				checkboxState: true,
				hideCheckBox: 2,
				defaultOptionId: 'arOption1',
			},
			'Arathia Clean': {
				color: '#31565a',
				options: {
					'arCleanOption1': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: arathiaClean,
						show: [arathiaBackground],
						hide: [mo_all_layers, ar_all_layers, morturiaBackground],
						checkboxIndex: 0,
						checkboxState: false,
						hideCheckboxCount: 2,
					},
					'arCleanOption2': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: Test3,
						show: [arathiaBackground],
						hide: [mo_all_layers, ar_all_layers, morturiaBackground],
						checkboxIndex: 1,
						checkboxState: false,
						hideCheckboxCount: 1,
					},
				},
				show: [arathiaBackground],
				hide: [mo_all_layers, ar_all_layers, morturiaBackground],
				current: arathiaClean,
				checkboxIndex: 0, 
				checkboxState: false,
				hideCheckBox: 2,
				defaultOptionId: 'arCleanOption1',
			},
			'Morturia': {
				color: '#374539',
				options: {
					'moOption1': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: morturia,
						show: [mo_all_layers, morturiaBackground],
						hide: [ar_all_layers, arathiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxCount: 1,
					},
					'moOption2': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: morturia,
						show: [mo_all_layers, morturiaBackground],
						hide: [ar_all_layers, arathiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxCount: 1,
					},
				},
				show: [mo_all_layers, morturiaBackground],
				hide: [ar_all_layers, arathiaBackground],
				current: morturia,
				checkboxIndex: 1, 
				checkboxState: true,
				hideCheckBox: 1,
				defaultOptionId: 'moOption1',
			},
			'Morturia Clean': {
				color: '#374539',
				options: {
					'moCleanOption1': {
						search: { controlSearch1: controlSearchMo },
						mapLayer: morturia,
						show: [mo_all_layers, morturiaBackground],
						hide: [ar_all_layers, arathiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxCount: 1,
					},
					'moCleanOption2': {
						search: { controlSearch1: controlSearchAr },
						mapLayer: morturia,
						show: [morturiaBackground],
						hide: [mo_all_layers, ar_all_layers, arathiaBackground],
						checkboxIndex: 1,
						checkboxState: true,
						hideCheckboxCount: 1,
					},
				},
				show: [morturiaBackground],
				hide: [mo_all_layers, ar_all_layers, arathiaBackground],
				current: morturia,
				checkboxIndex: 1, 
				checkboxState: false,
				hideCheckBox: 1,
				defaultOptionId: 'moCleanOption1',
			},
		};

		function addYearSelect() {
			var existingDropdown = document.getElementById('YearSelector');
			if (existingDropdown) {
				// If it exists, remove it before creating a new one
				existingDropdown.remove();
			}

			// Find the checked radio button
			var checkedRadioButton = document.querySelector('.leaflet-control-layers-base input[type="radio"]:checked');
			if (checkedRadioButton) {
				var label = checkedRadioButton.nextElementSibling;
			} else {
				console.error("No radiobutton found.");
			}

			// Create the dropdown box
			var dropdown = document.createElement('select');
			dropdown.name = 'options';
			dropdown.id = "YearSelector";
			dropdown.className = 'custom-select';

			// Add options to the dropdown
			switch (label && label.textContent.trim()) {
				case "Arathia": {
					createSelect("1257 A.A", "arOption1", dropdown);
					createSelect("67 B.A", "arOption2", dropdown);
					break;
				}
				case "Arathia Clean": {
					createSelect("1257 A.A", "arCleanOption1", dropdown);
					createSelect("67 B.A", "arCleanOption2", dropdown); 
					break;
				}
				case "Morturia": {
					createSelect("1257 A.A", "moOption1", dropdown);
					createSelect("???", "moOption2", dropdown); 
					break;
				}
			}

			// Insert the dropdown after the parent label of the checked radio button
			if (checkedRadioButton) {
				checkedRadioButton.closest('label').after(dropdown);
			} else if (lastCheckedRadioButtonLabel) {
				// Find the label with the text in lastCheckedRadioButtonLabel
				var labels = document.getElementsByTagName('label');
				for (var i = 0; i < labels.length; i++) {
					var label = labels[i];
					var span = label.querySelector('span');
					if (span && span.textContent.trim() === lastCheckedRadioButtonLabel) {
						console.log("Found Label")
						label.after(dropdown);
						break;
					}
				}
			} else {
				console.log("No radiobutton found");
			}
		}

		// Wait for the DOM to be ready
		function addRadioButtons(checked) {
			// Simplified createRadioButton function
			function createRadioButton(label, value, isChecked) {
				var radio = document.createElement("input");
				radio.type = "radio";
				radio.name = "layerSelector";
				radio.value = value;
				radio.checked = isChecked; // Direct assignment
				radio.classList.add("custom-radio-class");

				var labelElement = document.createElement("label");
				labelElement.appendChild(radio);
				labelElement.appendChild(document.createTextNode(label));
				return labelElement;
			}

			// Get the overlay control container
			var overlayContainer = document.querySelector('.leaflet-control-layers-overlays');

			// Check and remove existing radio buttons and separators
			var existingRadios = overlayContainer.querySelectorAll('.custom-radio-class');
			var existingSeparators = overlayContainer.querySelectorAll('.leaflet-control-layers-separator');

			existingRadios.forEach(function(radio) {
				radio.parentNode.remove(); // This assumes the radio button is wrapped in a label
			});
			existingSeparators.forEach(function(separator) {
				separator.remove();
			});

			// Create and append the separator div
			var separatorDiv = document.createElement("div");
			separatorDiv.classList.add("leaflet-control-layers-separator");
			overlayContainer.appendChild(separatorDiv);

			// Loop to create and append radio buttons
			radioButtonsInfo.forEach(info => {
				var radioButton = createRadioButton(info.label, info.option, checked === info.checkedIndex);
				radioButton.classList.add("leaflet-control-layers-selector");
				overlayContainer.appendChild(radioButton);
			});
		};

		document.addEventListener('DOMContentLoaded', function () {
			// Check the main checkbox
			var checkbox = document.querySelector('.leaflet-control-layers-group-selector');
			checkbox.checked = true;
			addRadioButtons(1)
			hideCheckBoxes(2);
			addYearSelect();
			document.getElementById('YearSelector').addEventListener('change', updateSelectedOptionId);
			fetch('data/markers.json')
				.then(response => response.json())
				.then(data => {
					processImportedData(data);
				})
				.catch(error => console.error('Error loading markers.json:', error));
		});

		const zoomControl = document.querySelector('.leaflet-control-zoom.leaflet-bar.leaflet-control');

		if (zoomControl) {
			const wikiButton = createControlButton('wiki', 'Wiki', 'icons/web1.png', 'icons/web2.png', (e) => {
				e.preventDefault();
				window.open('wiki', '_blank');
			});

			const cityButton = createControlButton('city', 'Opens the city map', 'icons/city1.png', 'icons/city2.png', (e) => {
				e.preventDefault();
				window.open('cities');
			});

			const exportButton = createControlButton('#', 'Export JSON', 'icons/export1.png', 'icons/export2.png', (e) => {
				e.preventDefault();
				exportMarkersToJson();
			});

			const importButton = createControlButton('#', 'Import JSON', 'icons/import1.png', 'icons/import2.png', (e) => {
				e.preventDefault();
				fileInput.click();
			});

			zoomControl.insertAdjacentElement('beforeend', wikiButton);
			zoomControl.insertAdjacentElement('beforeend', cityButton);
			zoomControl.insertAdjacentElement('beforeend', exportButton);
			zoomControl.insertAdjacentElement('beforeend', importButton);
		} else {
			console.error('Zoom control element not found');
		}

		document.getElementsByClassName('leaflet-control-attribution')[0].style.display = 'none';

		function createFileInput() {
			var fileInput = document.createElement('input');
			fileInput.type = 'file';
			fileInput.accept = '.json';
			fileInput.style.display = 'none';

			fileInput.addEventListener('change', function(event) {
				var file = event.target.files[0];
				if (file) {
					var reader = new FileReader();
					reader.onload = function(e) {
						var jsonData = JSON.parse(e.target.result);
						processImportedData(jsonData);
					};
					reader.readAsText(file);
				}
			});

			document.body.appendChild(fileInput);
			return fileInput;
		}
	</script>		
</body>

</html>